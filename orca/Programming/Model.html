<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <meta name="Generator" content="iWeb 3.0.2" />
    <meta name="iWeb-Build" content="local-build-20150109" />
    <meta http-equiv="X-UA-Compatible" content="IE=EmulateIE7" />
    <meta name="viewport" content="width=700" />
    <title>Model Example</title>
    <link rel="stylesheet" type="text/css" media="screen,print" href="Model_files/Model.css" />
    <!--[if lt IE 8]><link rel='stylesheet' type='text/css' media='screen,print' href='Model_files/ModelIE.css'/><![endif]-->
    <!--[if gte IE 8]><link rel='stylesheet' type='text/css' media='screen,print' href='Media/IE8.css'/><![endif]-->
    <script type="text/javascript" src="Scripts/iWebSite.js"></script>
    <script type="text/javascript" src="Scripts/Widgets/SharedResources/WidgetCommon.js"></script>
    <script type="text/javascript" src="Scripts/Widgets/Navbar/navbar.js"></script>
    <script type="text/javascript" src="Model_files/Model.js"></script>
  </head>
  <body style="background: rgb(255, 255, 255); margin: 0pt; " onload="onPageLoad();" onunload="onPageUnload();">
    <div style="text-align: center; ">
      <div style="margin-bottom: 0px; margin-left: auto; margin-right: auto; margin-top: 0px; overflow: hidden; position: relative; word-wrap: break-word;  background: transparent; text-align: left; width: 700px; " id="body_content">
        <div style="margin-left: 0px; position: relative; width: 700px; z-index: 0; " id="nav_layer">
          <div style="height: 0px; line-height: 0px; " class="bumper"> </div>
          <div class="com-apple-iweb-widget-navbar flowDefining" id="widget0" style="margin-left: 35px; margin-top: 0px; opacity: 1.00; position: relative; width: 630px; z-index: 1; ">
    
            <div id="widget0-navbar" class="navbar">

      
              <div id="widget0-bg" class="navbar-bg">

        
                <ul id="widget0-navbar-list" class="navbar-list">
 <li></li> 
</ul>
                
      
</div>
              
    
</div>
          </div>
          <script type="text/javascript"><!--//--><![CDATA[//><!--
new NavBar('widget0', 'Scripts/Widgets/Navbar', 'Scripts/Widgets/SharedResources', '.', {"path-to-root": "", "navbar-css": ".navbar {\n\tfont-family: Arial, sans-serif;\n\tfont-size: 1em;\n\tcolor: #666;\n\tmargin: 9px 0px 6px 0px;\n\tline-height: 30px;\n}\n\n.navbar-bg {\n\ttext-align: center;\n}\n\n.navbar-bg ul {\n\tlist-style: none;\n\tmargin: 0px;\n\tpadding: 0px;\n}\n\n\nli {\n\tlist-style-type: none;\n\tdisplay: inline;\n\tpadding: 0px 10px 0px 10px;\n}\n\n\nli a {\n\ttext-decoration: none;\n\tcolor: #666;\n}\n\nli a:visited {\n\ttext-decoration: none;\n\tcolor: #666;\n}\n\nli a:hover\r{\r\n \tcolor: #463C3C;\n\ttext-decoration: none;\r}\n\n\nli.current-page a\r{\r\t color: #463C3C;\n\ttext-decoration: none;\n\tfont-weight: bold;\r\r}", "current-page-GUID": "E03647E6-808D-4C92-9C38-0DC7FE2BCDAC", "isCollectionPage": "NO"});
//--><!]]></script>
          <div style="clear: both; height: 0px; line-height: 0px; " class="spacer"> </div>
        </div>
        <div style="height: 73px; margin-left: 0px; position: relative; width: 700px; z-index: 10; " id="header_layer">
          <div style="height: 0px; line-height: 0px; " class="bumper"> </div>
          <div id="id1" style="height: 50px; left: 35px; position: absolute; top: 23px; width: 630px; z-index: 1; " class="style_SkipStroke shape-with-text">
            <div class="text-content style_External_630_50" style="padding: 0px; ">
              <div class="style">
                <p style="padding-bottom: 0pt; padding-top: 0pt; " class="Header">Model Example</p>
              </div>
            </div>
          </div>
          


          <div style="height: 1px; width: 630px;  height: 1px; left: 35px; position: absolute; top: 3px; width: 630px; z-index: 1; " class="tinyText">
            <div style="position: relative; width: 630px; ">
              <img src="Model_files/shapeimage_1.jpg" alt="" style="height: 1px; left: 0px; position: absolute; top: 0px; width: 630px; " />
            </div>
          </div>
        </div>
        <div style="margin-left: 0px; position: relative; width: 700px; z-index: 5; " id="body_layer">
          <div style="height: 0px; line-height: 0px; " class="bumper"> </div>
          <div id="id2" style="height: 4161px; left: 8px; position: absolute; top: 17px; width: 700px; z-index: 1; " class="style_SkipStroke_1 shape-with-text">
            <div class="text-content graphic_textbox_layout_style_default_External_700_4161" style="padding: 0px; ">
              <div class="graphic_textbox_layout_style_default">
                <p style="padding-top: 0pt; " class="paragraph_style"><span class="style_1"><br /></span></p>
                <p class="paragraph_style"><span style="line-height: 19px; " class="style_2">Here is an example ORCA model object with commentary. It is a part of the CAMAC 811 ADC object. Note that not all of the object code is included here.<br /></span></p>
                <p class="paragraph_style"><span class="style_1"><br /></span></p>
                <p class="paragraph_style"><span class="style_1">* ORAD811Model.cpp<br /></span></p>
                <p class="paragraph_style"><span class="style_1">* Orca<br /></span></p>
                <p class="paragraph_style"><span class="style_1">*<br /></span></p>
                <p class="paragraph_style"><span class="style_1">* Created by Mark Howe on Sat Nov 16 2002.<br /></span></p>
                <p class="paragraph_style"><span class="style_1">* Copyright (c) 2002 CENPA, University of Washington. All rights reserved.<br /></span></p>
                <p class="paragraph_style"><span class="style_1">*<br /></span></p>
                <p class="paragraph_style"><span class="style_1">*/<br /></span></p>
                <p class="paragraph_style"><span class="style_1"><br /></span></p>
                <p class="paragraph_style"><span class="style_1">#pragma mark •••Imported Files<br /></span></p>
                <p class="paragraph_style"><span class="style_1">#import &quot;ORAD811Model.h&quot;<br /></span></p>
                <p class="paragraph_style"><span class="style_1">#import &quot;StatusLog.h&quot;<br /></span></p>
                <p class="paragraph_style"><span class="style_1">#import &quot;ORDataTypeAssigner.h&quot;<br /></span></p>
                <p class="paragraph_style"><span class="style_1">#import &quot;ORParamItem.h&quot;<br /></span></p>
                <p class="paragraph_style"><span class="style_1">#import &quot;ORDataDescriptionItem.h&quot;<br /></span></p>
                <p class="paragraph_style"><span class="style_1">#import &quot;ORHeaderSection.h&quot;<br /></span></p>
                <p class="paragraph_style"><span class="style_1">#import &quot;ORDataPacket.h&quot;<br /></span></p>
                <p class="paragraph_style"><span class="style_1">#import &quot;ORCamacControllerCard.h&quot;<br /></span></p>
                <p class="paragraph_style"><span class="style_1">#import &quot;ORCamacCrateModel.h&quot;<br /></span></p>
                <p class="paragraph_style"><span class="style_1"><br /></span></p>
                <p class="paragraph_style"><span class="style_1">NSString* ORAD811OnlineMaskChangedNotification    = @&quot;ORAD811OnlineMaskChangedNotification&quot;;<br /></span></p>
                <p class="paragraph_style"><span class="style_1">NSString* ORAD811SettingsLock                     = @&quot;ORAD811SettingsLock&quot;;<br /></span></p>
                <p class="paragraph_style"><span class="style_1">NSString* ORAD811SuppressZerosChangedNotification = @&quot;ORAD811SuppressZerosChangedNotification&quot;;<br /></span></p>
                <p class="paragraph_style"><span class="style_1"><br /></span></p>
                <p class="paragraph_style"><span class="style_1">@implementation ORAD811Model<br /></span></p>
                <p class="paragraph_style"><span class="style_1"><br /></span></p>
                <p class="paragraph_style"><span class="style_1">#pragma mark •••Initialization<br /></span></p>
                <p class="paragraph_style"><span class="style_1">- (id) init<br /></span></p>
                <p class="paragraph_style"><span class="style_1">{<br /></span></p>
                <p class="paragraph_style"><span class="style_1">    self = [super init];<br /></span></p>
                <p class="paragraph_style"><span class="style_1">    return self;<br /></span></p>
                <p class="paragraph_style"><span class="style_1">}<br /></span></p>
                <p class="paragraph_style"><span class="style_1"><br /></span></p>
                <p class="paragraph_style"><span class="style_1">- (void) dealloc<br /></span></p>
                <p class="paragraph_style"><span class="style_1">{<br /></span></p>
                <p class="paragraph_style"><span class="style_1">    [super dealloc];<br /></span></p>
                <p class="paragraph_style"><span class="style_1">}<br /></span></p>
                <p class="paragraph_style"><span class="style_1"><br /></span></p>
                <p class="paragraph_style"><span class="style_1">- (void) setUpImage<br /></span></p>
                <p class="paragraph_style"><span class="style_1">{<br /></span></p>
                <p class="paragraph_style"><span class="style_1">    [self setImage:[NSImage imageNamed:@&quot;AD811Card&quot;]];  //Defines the object's icon<br /></span></p>
                <p class="paragraph_style"><span class="style_1">}<br /></span></p>
                <p class="paragraph_style"><span class="style_1"><br /></span></p>
                <p class="paragraph_style"><span class="style_1">- (void) makeMainController<br /></span></p>
                <p class="paragraph_style"><span class="style_1">{    <br /></span></p>
                <p class="paragraph_style"><span class="style_1">    [self linkToController:@&quot;ORAD811Controller&quot;];      //This is the object's controller...i.e. the<br /></span></p>
                <p class="paragraph_style"><span class="style_1">                                                       //glue code between the view and the model<br /></span></p>
                <p class="paragraph_style"><span class="style_1">}<br /></span></p>
                <p class="paragraph_style"><span class="style_1"><br /></span></p>
                <p class="paragraph_style"><span class="style_1">#pragma mark •••Accessors<br /></span></p>
                <p class="paragraph_style"><span class="style_1">- (unsigned long) dataId <br /></span></p>
                <p class="paragraph_style"><span class="style_1">{ <br /></span></p>
                <p class="paragraph_style"><span class="style_1">    return dataId;                                    //Data ids are used to uniquely identify an object's<br /></span></p>
                <p class="paragraph_style"><span class="style_1">}                                                     //data record(s). An object will have one data for <br /></span></p>
                <p class="paragraph_style"><span class="style_1">- (void) setDataId: (unsigned long) DataId            //record that it will put into the data stream. <br /></span></p>
                <p class="paragraph_style"><span class="style_1">{<br /></span></p>
                <p class="paragraph_style"><span class="style_1">    dataId = DataId;<br /></span></p>
                <p class="paragraph_style"><span class="style_1">}<br /></span></p>
                <p class="paragraph_style"><span class="style_1"><br /></span></p>
                <p class="paragraph_style"><span class="style_1">- (unsigned char)onlineMask {<br /></span></p>
                <p class="paragraph_style"><span class="style_1"><br /></span></p>
                <p class="paragraph_style"><span class="style_1">    return onlineMask;<br /></span></p>
                <p class="paragraph_style"><span class="style_1">}<br /></span></p>
                <p class="paragraph_style"><span class="style_1"><br /></span></p>
                <p class="paragraph_style"><span class="style_1">- (void)setOnlineMask:(unsigned char)anOnlineMask <br /></span></p>
                <p class="paragraph_style"><span class="style_1">{<br /></span></p>
                <p class="paragraph_style"><span class="style_1">    //Setters that are 'undoable' have to register with the undo manager<br /></span></p>
                <p class="paragraph_style"><span class="style_1">    [[[self undoManager] prepareWithInvocationTarget:self] setOnlineMask:[self onlineMask]];<br /></span></p>
                <p class="paragraph_style"><span class="style_1"><br /></span></p>
                <p class="paragraph_style"><span class="style_1">    onlineMask = anOnlineMask;<br /></span></p>
                <p class="paragraph_style"><span class="style_1"><br /></span></p>
                <p class="paragraph_style"><span class="style_1">    //Variables that are displayed to the user must post the fact that they have changed.<br /></span></p>
                <p class="paragraph_style"><span class="style_1">    //These notifications are picked by the Controller objects that pass the model data<br /></span></p>
                <p class="paragraph_style"><span class="style_1">    //on to the view.<br /></span></p>
                <p class="paragraph_style"><span class="style_1"> <br /></span></p>
                <p class="paragraph_style"><span class="style_1">    [[NSNotificationCenter defaultCenter]<br /></span></p>
                <p class="paragraph_style"><span class="style_1">        postNotificationName:ORAD811OnlineMaskChangedNotification object:self];<br /></span></p>
                <p class="paragraph_style"><span class="style_1"><br /></span></p>
                <p class="paragraph_style"><span class="style_1">}<br /></span></p>
                <p class="paragraph_style"><span class="style_1"><br /></span></p>
                <p class="paragraph_style"><span class="style_1">...<br /></span></p>
                <p class="paragraph_style"><span class="style_1">...<br /></span></p>
                <p class="paragraph_style"><span class="style_1">...<br /></span></p>
                <p class="paragraph_style"><span class="style_1"><br /></span></p>
                <p class="paragraph_style"><span class="style_1">#pragma mark •••DataTaker<br /></span></p>
                <p class="paragraph_style"><span class="style_1"><br /></span></p>
                <p class="paragraph_style"><span class="style_1">- (void) setDataIds:(id)assigner<br /></span></p>
                <p class="paragraph_style"><span class="style_1">{                                                 //This method is called so data taking objects can<br /></span></p>
                <p class="paragraph_style"><span class="style_1">    dataId = [assigner assignDataIds:kShortForm]; //assign their data ids. Objects can request to use <br /></span></p>
                <p class="paragraph_style"><span class="style_1">}                                                 //the 'short' form but may be assigned the 'long' form,<br /></span></p>
                <p class="paragraph_style"><span class="style_1">                                                  //so they must be prepared to deal with either type.<br /></span></p>
                <p class="paragraph_style"><span class="style_1">- (void) syncDataIdsWith:(id)anotherCard          //Note that there is only one Data id per object of this<br /></span></p>
                <p class="paragraph_style"><span class="style_1">{                                                 //class no matter how many instances there are. Also <br /></span></p>
                <p class="paragraph_style"><span class="style_1">    [self setDataId:[anotherCard dataId]];        //note that there would be additional entries in these<br /></span></p>
                <p class="paragraph_style"><span class="style_1">}                                                 //methods it this object could produce other data records.<br /></span></p>
                <p class="paragraph_style"><span class="style_1"><br /></span></p>
                <p class="paragraph_style"><span class="style_1"> <br /></span></p>
                <p class="paragraph_style"><span class="style_1"><br /></span></p>
                <p class="paragraph_style"><span class="style_1"><br /></span></p>
                <p class="paragraph_style"><span class="style_1">//All objects that need to put an kind of record must have a 'dataRecordDescription' method. <br /></span></p>
                <p class="paragraph_style"><span class="style_1">//The resulting info is put in the data header so that the records can be decoded by others.<br /></span></p>
                <p class="paragraph_style"><span class="style_1">- (NSDictionary*) dataRecordDescription<br /></span></p>
                <p class="paragraph_style"><span class="style_1">{<br /></span></p>
                <p class="paragraph_style"><span class="style_1">    NSMutableDictionary* dataDictionary = [NSMutableDictionary dictionary];<br /></span></p>
                <p class="paragraph_style"><span class="style_1">    NSDictionary* aDictionary = [NSDictionary dictionaryWithObjectsAndKeys:<br /></span></p>
                <p class="paragraph_style"><span class="style_1">        @&quot;ORAD811DecoderForAdc&quot;,          @&quot;decoder&quot;,<br /></span></p>
                <p class="paragraph_style"><span class="style_1">        [NSNumber numberWithLong:dataId], @&quot;dataId&quot;,<br /></span></p>
                <p class="paragraph_style"><span class="style_1">        [NSNumber numberWithBool:NO],     @&quot;variable&quot;,<br /></span></p>
                <p class="paragraph_style"><span class="style_1">        [NSNumber numberWithLong:IsShortForm(dataId)?1:2],@&quot;length&quot;,<br /></span></p>
                <p class="paragraph_style"><span class="style_1">        [NSNumber numberWithBool:YES],    @&quot;canBeGated&quot;,<br /></span></p>
                <p class="paragraph_style"><span class="style_1">        nil];<br /></span></p>
                <p class="paragraph_style"><span class="style_1">    [dataDictionary setObject:aDictionary forKey:@&quot;ADC&quot;];<br /></span></p>
                <p class="paragraph_style"><span class="style_1">    return dataDictionary;<br /></span></p>
                <p class="paragraph_style"><span class="style_1">}<br /></span></p>
                <p class="paragraph_style"><span class="style_1"><br /></span></p>
                <p class="paragraph_style"><span class="style_1">//At the start of run, all data taking objects receive the 'runTaskStarted' message. It is here that<br /></span></p>
                <p class="paragraph_style"><span class="style_1">//hardware initialization and prerun checks are normally done. Also note the the data description<br /></span></p>
                <p class="paragraph_style"><span class="style_1">//is added to the data packet at this time. <br /></span></p>
                <p class="paragraph_style"><span class="style_1">- (void) runTaskStarted:(ORDataPacket*)aDataPacket userInfo:(id)userInfo<br /></span></p>
                <p class="paragraph_style"><span class="style_1">{<br /></span></p>
                <p class="paragraph_style"><span class="style_1"><br /></span></p>
                <p class="paragraph_style"><span class="style_1">    if(![self adapter]){<br /></span></p>
                <p class="paragraph_style"><span class="style_1">        [NSException raise:@&quot;Not Connected&quot; format:@&quot;You must connect to a PCI-CAMAC Controller (i.e. a CC32).&quot;];<br /></span></p>
                <p class="paragraph_style"><span class="style_1">    }<br /></span></p>
                <p class="paragraph_style"><span class="style_1"><br /></span></p>
                <p class="paragraph_style"><span class="style_1">//----------------------------------------------------------------------------------------<br /></span></p>
                <p class="paragraph_style"><span class="style_1">// first add our description to the data description<br /></span></p>
                <p class="paragraph_style"><span class="style_1"><br /></span></p>
                <p class="paragraph_style"><span class="style_1">    [aDataPacket addDataDescriptionItem:[self dataRecordDescription] forKey:@&quot;ORAD811Model&quot;];<br /></span></p>
                <p class="paragraph_style"><span class="style_1"><br /></span></p>
                <p class="paragraph_style"><span class="style_1">//----------------------------------------------------------------------------------------<br /></span></p>
                <p class="paragraph_style"><span class="style_1">    controller = [[self adapter] controller]; //cache the controller for alittle bit more speed.<br /></span></p>
                <p class="paragraph_style"><span class="style_1">    unChangingDataPart = (([self crateNumber]&amp;0x1e)&lt;&lt;21) | (([self stationNumber]&amp; 0x0000001f)&lt;&lt;16); //doesn't change so do it here.<br /></span></p>
                <p class="paragraph_style"><span class="style_1">    cachedStation = [self stationNumber];<br /></span></p>
                <p class="paragraph_style"><span class="style_1">    [self clearExceptionCount];<br /></span></p>
                <p class="paragraph_style"><span class="style_1"><br /></span></p>
                <p class="paragraph_style"><span class="style_1"> <br /></span></p>
                <p class="paragraph_style"><span class="style_1">    int i;<br /></span></p>
                <p class="paragraph_style"><span class="style_1">    onlineChannelCount = 0;<br /></span></p>
                <p class="paragraph_style"><span class="style_1">    for(i=0;i&lt;8;i++){<br /></span></p>
                <p class="paragraph_style"><span class="style_1">        if(onlineMask &amp; (0x1&lt;&lt;i)){<br /></span></p>
                <p class="paragraph_style"><span class="style_1">            onlineList[onlineChannelCount] = i;<br /></span></p>
                <p class="paragraph_style"><span class="style_1">            onlineChannelCount++;<br /></span></p>
                <p class="paragraph_style"><span class="style_1">        }<br /></span></p>
                <p class="paragraph_style"><span class="style_1">    }<br /></span></p>
                <p class="paragraph_style"><span class="style_1"><br /></span></p>
                <p class="paragraph_style"><span class="style_1"><br /></span></p>
                <p class="paragraph_style"><span class="style_1">    if([[userInfo objectForKey:@&quot;doinit&quot;]intValue]){<br /></span></p>
                <p class="paragraph_style"><span class="style_1">        [self generalReset];<br /></span></p>
                <p class="paragraph_style"><span class="style_1">    }<br /></span></p>
                <p class="paragraph_style"><span class="style_1">    [self enableLAMEnableLatch];<br /></span></p>
                <p class="paragraph_style"><span class="style_1">}<br /></span></p>
                <p class="paragraph_style"><span class="style_1"><br /></span></p>
                <p class="paragraph_style"><span class="style_1">//The 'takeData' is called continuously during the data taking phase of a run. This happens in the <br /></span></p>
                <p class="paragraph_style"><span class="style_1">//data taking thread, it is is important to remember that calls made to methods that may also<br /></span></p>
                <p class="paragraph_style"><span class="style_1">//be called from other threads must be thread-safe or chaos will ensue.<br /></span></p>
                <p class="paragraph_style"><span class="style_1">- (void) takeData:(ORDataPacket*)aDataPacket userInfo:(id)userInfo<br /></span></p>
                <p class="paragraph_style"><span class="style_1">{<br /></span></p>
                <p class="paragraph_style"><span class="style_1">    NSString* errorLocation;<br /></span></p>
                <p class="paragraph_style"><span class="style_1">    BOOL resetDone;<br /></span></p>
                <p class="paragraph_style"><span class="style_1">    NS_DURING<br /></span></p>
                <p class="paragraph_style"><span class="style_1"><br /></span></p>
                <p class="paragraph_style"><span class="style_1">        //check the LAM<br /></span></p>
                <p class="paragraph_style"><span class="style_1">        unsigned short dummy;<br /></span></p>
                <p class="paragraph_style"><span class="style_1">        unsigned short status = [controller camacShortNAF:cachedStation a:12 f:8 data:&amp;dummy];<br /></span></p>
                <p class="paragraph_style"><span class="style_1">        if(isQbitSet(status)) { //LAM status comes back in the Q bit<br /></span></p>
                <p class="paragraph_style"><span class="style_1">            if(onlineChannelCount){<br /></span></p>
                <p class="paragraph_style"><span class="style_1">                resetDone = NO;<br /></span></p>
                <p class="paragraph_style"><span class="style_1">                int i;<br /></span></p>
                <p class="paragraph_style"><span class="style_1">                for(i=0;i&lt;onlineChannelCount;i++){<br /></span></p>
                <p class="paragraph_style"><span class="style_1">                    //read one adc channnel<br /></span></p>
                <p class="paragraph_style"><span class="style_1">                    unsigned short adcValue;<br /></span></p>
                <p class="paragraph_style"><span class="style_1">                    [controller camacShortNAF:cachedStation a:onlineList[i] f:2 data:&amp;adcValue];<br /></span></p>
                <p class="paragraph_style"><span class="style_1">                    if(!(suppressZeros &amp;&amp; adcValue==0)){<br /></span></p>
                <p class="paragraph_style"><span class="style_1">                        if(IsShortForm(dataId)){<br /></span></p>
                <p class="paragraph_style"><span class="style_1">                            unsigned long data = dataId | <br /></span></p>
                <p class="paragraph_style"><span class="style_1">                                                 unChangingDataPart | <br /></span></p>
                <p class="paragraph_style"><span class="style_1">                                                 (onlineList[i]&amp;0xf)&lt;&lt;12 | <br /></span></p>
                <p class="paragraph_style"><span class="style_1">                                                 (adcValue &amp; 0xfff);<br /></span></p>
                <p class="paragraph_style"><span class="style_1">                            [aDataPacket addLongsToFrameBuffer:&amp;data length:1];<br /></span></p>
                <p class="paragraph_style"><span class="style_1">                        }<br /></span></p>
                <p class="paragraph_style"><span class="style_1">                        else {<br /></span></p>
                <p class="paragraph_style"><span class="style_1">                            unsigned long data[2];<br /></span></p>
                <p class="paragraph_style"><span class="style_1">                            data[0] = dataId | 2;<br /></span></p>
                <p class="paragraph_style"><span class="style_1">                            data[1] = unChangingDataPart | (onlineList[i]&amp;0xf)&lt;&lt;12 | (adcValue &amp; 0xfff);<br /></span></p>
                <p class="paragraph_style"><span class="style_1">                            [aDataPacket addLongsToFrameBuffer:data length:2];<br /></span></p>
                <p class="paragraph_style"><span class="style_1">                        }<br /></span></p>
                <p class="paragraph_style"><span class="style_1">                    }<br /></span></p>
                <p class="paragraph_style"><span class="style_1">                    if(i == 7) resetDone = YES;<br /></span></p>
                <p class="paragraph_style"><span class="style_1">                }<br /></span></p>
                <p class="paragraph_style"><span class="style_1">               //read of last channel with this command clears<br /></span></p>
                <p class="paragraph_style"><span class="style_1">               if(!resetDone) [controller camacShortNAF:[self stationNumber] a:7 f:2 data:&amp;dummy];<br /></span></p>
                <p class="paragraph_style"><span class="style_1">           }<br /></span></p>
                <p class="paragraph_style"><span class="style_1">    NS_    }<br /></span></p>
                <p class="paragraph_style"><span class="style_1">  HANDLER<br /></span></p>
                <p class="paragraph_style"><span class="style_1">        NSLogError(@&quot;&quot;,@&quot;AD811 Card Error&quot;,errorLocation,nil);<br /></span></p>
                <p class="paragraph_style"><span class="style_1">        [self incExceptionCount];<br /></span></p>
                <p class="paragraph_style"><span class="style_1">        [localException raise];<br /></span></p>
                <p class="paragraph_style"><span class="style_1">    NS_ENDHANDLER<br /></span></p>
                <p class="paragraph_style"><span class="style_1">}<br /></span></p>
                <p class="paragraph_style"><span class="style_1"><br /></span></p>
                <p class="paragraph_style"><span class="style_1"><br /></span></p>
                <p class="paragraph_style"><span class="style_1">//The 'runTaskStopped' method is called end the run has ended. This object does nothing, but in general <br /></span></p>
                <p class="paragraph_style"><span class="style_1">//it would be the place to do any hardware shutdown that is required or last minute records inserted into<br /></span></p>
                <p class="paragraph_style"><span class="style_1">//the data stream. There is one other method called 'runCloseOut' that is called after<br /></span></p>
                <p class="paragraph_style"><span class="style_1">//the run has stopped as a oppertunity after all objects have been notified that the run is stopped. <br /></span></p>
                <p class="paragraph_style"><span class="style_1">- (void) runTaskStopped:(ORDataPacket*)aDataPacket userInfo:(id)userInfo<br /></span></p>
                <p class="paragraph_style"><span class="style_1">{<br /></span></p>
                <p class="paragraph_style"><span class="style_1">}<br /></span></p>
                <p class="paragraph_style"><span class="style_1"><br /></span></p>
                <p class="paragraph_style"><span class="style_1">...<br /></span></p>
                <p class="paragraph_style"><span class="style_1">...<br /></span></p>
                <p class="paragraph_style"><span class="style_1">...<br /></span></p>
                <p class="paragraph_style"><span class="style_1"><br /></span></p>
                <p class="paragraph_style"><span class="style_1">#pragma mark •••Archival<br /></span></p>
                <p class="paragraph_style"><span class="style_1"><br /></span></p>
                <p class="paragraph_style"><span class="style_1">//Here is where the object stores its persistant data. The data is stored in the configuration file.<br /></span></p>
                <p class="paragraph_style"><span class="style_1">- (id)initWithCoder:(NSCoder*)decoder<br /></span></p>
                <p class="paragraph_style"><span class="style_1">{<br /></span></p>
                <p class="paragraph_style"><span class="style_1">    [self = [super initWithCoder:decoder];<br /></span></p>
                <p class="paragraph_style"><span class="style_1">    [[self undoManager] disableUndoRegistration];<br /></span></p>
                <p class="paragraph_style"><span class="style_1">    [self setOnlineMask:[decoder decodeIntForKey:@&quot;OR811OnlineMask&quot;]];<br /></span></p>
                <p class="paragraph_style"><span class="style_1">    [self setSuppressZeros:[decoder decodeIntForKey:@&quot;OR811SuppressZeros&quot;]];<br /></span></p>
                <p class="paragraph_style"><span class="style_1">    [[self undoManager] enableUndoRegistration];<br /></span></p>
                <p class="paragraph_style"><span class="style_1">    return self;<br /></span></p>
                <p class="paragraph_style"><span class="style_1">}<br /></span></p>
                <p class="paragraph_style"><span class="style_1"><br /></span></p>
                <p class="paragraph_style"><span class="style_1">//Here is where the object read its persistant data back in. <br /></span></p>
                <p class="paragraph_style"><span class="style_1">- (void)encodeWithCoder:(NSCoder*)encoder<br /></span></p>
                <p class="paragraph_style"><span class="style_1">{<br /></span></p>
                <p class="paragraph_style"><span class="style_1">    [super encodeWithCoder:encoder];<br /></span></p>
                <p class="paragraph_style"><span class="style_1">    [encoder encodeInt:onlineMask forKey:@&quot;OR811OnlineMask&quot;];<br /></span></p>
                <p class="paragraph_style"><span class="style_1">    [encoder encodeInt:suppressZeros forKey:@&quot;OR811SuppressZeros&quot;];<br /></span></p>
                <p class="paragraph_style"><span class="style_1">}<br /></span></p>
                <p class="paragraph_style"><span class="style_1"><br /></span></p>
                <p class="paragraph_style"><span class="style_1">//This method is called for records that need to be placed into the data header. Usually that means<br /></span></p>
                <p class="paragraph_style"><span class="style_1">//state data that is important for data analysis, i.e. gains, thresholds, etc... <br /></span></p>
                <p class="paragraph_style"><span class="style_1">- (NSMutableDictionary*) captureCurrentState:(NSMutableDictionary*)dictionary<br /></span></p>
                <p class="paragraph_style"><span class="style_1">{<br /></span></p>
                <p class="paragraph_style"><span class="style_1">    [NSMutableDictionary* objDictionary = [super captureCurrentState:dictionary];<br /></span></p>
                <p class="paragraph_style"><span class="style_1">    [objDictionary setObject:[NSNumber numberWithInt:onlineMask] forKey:@&quot;onlineMask&quot;];<br /></span></p>
                <p class="paragraph_style"><span class="style_1">    [objDictionary setObject:[NSNumber numberWithBool:suppressZeros] forKey:@&quot;suppressZeros&quot;];<br /></span></p>
                <p class="paragraph_style"><span class="style_1">    return objDictionary;<br /></span></p>
                <p class="paragraph_style"><span class="style_1">}<br /></span></p>
                <p class="paragraph_style"><span class="style_1"><br /></span></p>
                <p style="padding-bottom: 0pt; " class="paragraph_style"><span class="style_1">@end</span></p>
              </div>
            </div>
          </div>
          <div style="height: 4178px; line-height: 4178px; " class="spacer"> </div>
        </div>
        <div style="height: 150px; margin-left: 0px; position: relative; width: 700px; z-index: 15; " id="footer_layer">
          <div style="height: 0px; line-height: 0px; " class="bumper"> </div>
        </div>
      </div>
    </div>
  </body>
</html>


