<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <meta name="Generator" content="iWeb 3.0.2" />
    <meta name="iWeb-Build" content="local-build-20150109" />
    <meta http-equiv="X-UA-Compatible" content="IE=EmulateIE7" />
    <meta name="viewport" content="width=700" />
    <title>CouchDB Listener</title>
    <link rel="stylesheet" type="text/css" media="screen,print" href="CouchDB_Listener_files/CouchDB_Listener.css" />
    <!--[if lt IE 8]><link rel='stylesheet' type='text/css' media='screen,print' href='CouchDB_Listener_files/CouchDB_ListenerIE.css'/><![endif]-->
    <!--[if gte IE 8]><link rel='stylesheet' type='text/css' media='screen,print' href='Media/IE8.css'/><![endif]-->
    <script type="text/javascript" src="Scripts/iWebSite.js"></script>
    <script type="text/javascript" src="Scripts/Widgets/SharedResources/WidgetCommon.js"></script>
    <script type="text/javascript" src="Scripts/Widgets/Navbar/navbar.js"></script>
    <script type="text/javascript" src="Scripts/iWebImage.js"></script>
    <script type="text/javascript" src="CouchDB_Listener_files/CouchDB_Listener.js"></script>
  </head>
  <body style="background: rgb(255, 255, 255); margin: 0pt; " onload="onPageLoad();" onunload="onPageUnload();">
    <div style="text-align: center; ">
      <div style="margin-bottom: 0px; margin-left: auto; margin-right: auto; margin-top: 0px; overflow: hidden; position: relative; word-wrap: break-word;  background: transparent; text-align: left; width: 700px; " id="body_content">
        <div style="margin-left: 0px; position: relative; width: 700px; z-index: 0; " id="nav_layer">
          <div style="height: 0px; line-height: 0px; " class="bumper"> </div>
          <div class="com-apple-iweb-widget-navbar flowDefining" id="widget0" style="margin-left: 35px; margin-top: 0px; opacity: 1.00; position: relative; width: 630px; z-index: 1; ">
    
            <div id="widget0-navbar" class="navbar">

      
              <div id="widget0-bg" class="navbar-bg">

        
                <ul id="widget0-navbar-list" class="navbar-list">
 <li></li> 
</ul>
                
      
</div>
              
    
</div>
          </div>
          <script type="text/javascript"><!--//--><![CDATA[//><!--
new NavBar('widget0', 'Scripts/Widgets/Navbar', 'Scripts/Widgets/SharedResources', '.', {"path-to-root": "", "navbar-css": ".navbar {\n\tfont-family: Arial, sans-serif;\n\tfont-size: 1em;\n\tcolor: #666;\n\tmargin: 9px 0px 6px 0px;\n\tline-height: 30px;\n}\n\n.navbar-bg {\n\ttext-align: center;\n}\n\n.navbar-bg ul {\n\tlist-style: none;\n\tmargin: 0px;\n\tpadding: 0px;\n}\n\n\nli {\n\tlist-style-type: none;\n\tdisplay: inline;\n\tpadding: 0px 10px 0px 10px;\n}\n\n\nli a {\n\ttext-decoration: none;\n\tcolor: #666;\n}\n\nli a:visited {\n\ttext-decoration: none;\n\tcolor: #666;\n}\n\nli a:hover\r{\r\n \tcolor: #463C3C;\n\ttext-decoration: none;\r}\n\n\nli.current-page a\r{\r\t color: #463C3C;\n\ttext-decoration: none;\n\tfont-weight: bold;\r\r}", "current-page-GUID": "B9378524-6939-4970-86EC-96EE00130FA1", "isCollectionPage": "NO"});
//--><!]]></script>
          <div style="clear: both; height: 0px; line-height: 0px; " class="spacer"> </div>
        </div>
        <div style="height: 73px; margin-left: 0px; position: relative; width: 700px; z-index: 10; " id="header_layer">
          <div style="height: 0px; line-height: 0px; " class="bumper"> </div>
          <div id="id1" style="height: 50px; left: 35px; position: absolute; top: 23px; width: 630px; z-index: 1; " class="style_SkipStroke shape-with-text">
            <div class="text-content style_External_630_50" style="padding: 0px; ">
              <div class="style">
                <p style="padding-bottom: 0pt; padding-top: 0pt; " class="Header">CouchDB Listener</p>
              </div>
            </div>
          </div>
          


          <div style="height: 1px; width: 630px;  height: 1px; left: 35px; position: absolute; top: 3px; width: 630px; z-index: 1; " class="tinyText">
            <div style="position: relative; width: 630px; ">
              <img src="CouchDB_Listener_files/shapeimage_1.jpg" alt="" style="height: 1px; left: 0px; position: absolute; top: 0px; width: 630px; " />
            </div>
          </div>
        </div>
        <div style="margin-left: 0px; position: relative; width: 700px; z-index: 5; " id="body_layer">
          <div style="height: 0px; line-height: 0px; " class="bumper"> </div>
          <div style="height: 554px; width: 549px;  height: 554px; left: -4px; position: absolute; top: 128px; width: 549px; z-index: 1; " class="tinyText style_SkipStroke_1 stroke_0">
            <img src="CouchDB_Listener_files/Screen%20Shot%202013-06-06%20at%209.35.09%20AM.png" alt="" style="border: none; height: 554px; width: 550px; " />
          </div>
          <div style="height: 1px; line-height: 1px; " class="tinyText"> </div>
          <div style="margin-left: 8px; margin-top: 13px; position: relative; width: 683px; z-index: 1; " class="style_SkipStroke_3 shape-with-text flowDefining">
            <div class="text-content style_External_683_103" style="padding: 0px; ">
              <div class="style">
                <div class="paragraph Body" style="padding-top: 0pt; "><div style="height: 88px; width: 114px;  clear: left; float: left; height: 88px; margin: 6px 6px 6px 0px; position: relative; width: 114px; " class="tinyText style_SkipStroke_2 inline-block shadow_0"><img src="CouchDB_Listener_files/Changesfeed.png" alt="" style="border: none; height: 89px; width: 114px; " /></div><br /></div>
                <p style="padding-bottom: 0pt; " class="Body">The CouchDB Listener is found in the Catalog under 'misc'. After dragging it into an experiment and opening the user interface, you see the following dialog:</p>
              </div>
              <div style="clear: both; height: 0px; line-height: 0px; " class="tinyText"> </div>
            </div>
          </div>
          


          <div style="height: 62px; width: 345px;  height: 61px; left: 46px; position: absolute; top: 180px; width: 344px; z-index: 1; " class="tinyText">
            <div style="position: relative; width: 344px; ">
              <img src="CouchDB_Listener_files/shapeimage_2.png" alt="" style="height: 62px; left: 0px; position: absolute; top: 0px; width: 345px; " />
            </div>
          </div>
          


          <div style="height: 16px; width: 180px;  height: 14px; left: 389px; position: absolute; top: 175px; width: 179px; z-index: 1; " class="tinyText">
            <div style="position: relative; width: 179px; ">
              <img src="CouchDB_Listener_files/shapeimage_3.png" alt="" style="height: 16px; left: 0px; margin-top: -1px; position: absolute; top: 0px; width: 180px; " />
            </div>
          </div>
          


          <div id="id2" style="height: 1922px; left: 8px; position: absolute; top: 670px; width: 683px; z-index: 1; " class="style_SkipStroke_3 shape-with-text">
            <div class="text-content style_External_683_1922" style="padding: 0px; ">
              <div class="style">
                <p style="padding-top: 0pt; " class="Body"><span style="line-height: 66px; " class="style_1">1<br /></span></p>
                <p class="Body">Here you configure the connection to a CouchDB server. After entering a host address and a port (default values are 'localhost' and '5984') you can enter an existing database name or choose one from the drop down menu. The listener automatically tries to obtain a list of databases whenever the host field is modified. Username and password are optional. The 'heartbeat' field sets the time interval for the changes feed in ms (default is 5000). That means, after the connection has been established the listener receives a newline character from CouchDB every &lt;heartbeat&gt; milliseconds to keep the connection alive. Practically this value should have no influence on the behavior of the CouchDBListener, although a very small value will put more stress on the CPU and a too high value might lead to a timeout of the underlying C-sockets. For safety you might choose a value in the range of some seconds (1000 - 10000). <br /></p>
                <p class="Body"><br /></p>
                <p class="Body"><span style="line-height: 66px; " class="style_1">2</span><br /></p>
                <p class="Body">The big button 'Listen!' in the upper right corner tells the CouchDBListener to start a session, which means:<br /></p>
                <p class="Body">- the button's title is set to 'Stop!'<br /></p>
                <p class="Body">- all other controls on the user interface are disabled<br /></p>
                <p class="Body">- the selected control structures (see 2.) are uploaded <br /></p>
                <p class="Body">- a message document is uploaded<br /></p>
                <p class="Body">- a changes feed is started<br /></p>
                <p class="Body">- CouchDBListener will react to every change happening to the uploaded documents he only database in existence at the time of this writing is at UNC on the ORCA development machine. You will probably want to set up your own local database. Here’s how:<br /></p>
                <p class="paragraph_style"><br /></p>
                <p class="Body"><span style="line-height: 66px; " class="style_1">3</span><br /></p>
                <p class="Body">Here you can create a list of commands a client will be able to execute from CouchDB. The commands are displayed in the green table, which is initially empty. One command consists of a 'Label', an 'Object', a 'Selector', a default 'Value' and an 'Info' string. In order to create a command, you fill the form below the table and then click the 'Add' button.<br /></p>
                <p class="Body"><br /></p>
                <p class="Body">'Label' serves as a unique key to the command and a client will use that key later to execute it. One label may not be used twice. If you try, the command is not added and an error message is logged to the status log below.<br /></p>
                <p class="Body">'Object' refers to the ORCA object you want to perform one of its methods. What you enter here is the objectID string (same as you pass to the 'find' function in ORCA script). For convenience all objects in the experiment and its subviews are listed in the dropdown menu. This list can be updated by clicking the 'update' button. <br /></p>
                <p class="Body">After selecting an object its methods are automatically listed in the dropdown menu of the 'Selector' field. You can either select one from the list or use the autocomplete feature to search for a method. <br /></p>
                <p class="Body">Note that if a selector requires arguments, you either have to enter them directly after the colon or you can enter '$1' for one argument per selector (like in the command label object). This means that the client can define this argument on CouchDB or, if not, the default value will be used. <br /></p>
                <p class="Body">In the 'Info' field you can provide information on the command for the client. <br /></p>
                <p class="Body"><br /></p>
                <p class="Body">Having added at least one commmand, you might want to check if it executes properly. To do this, select the command in the table and click the 'Execute (test)' button. It runs the command once and logs a success message to the status log. <br /></p>
                <p class="Body"><br /></p>
                <p class="Body">'Remove' removes the command from the table. 'Edit' also removes the command but displays its contents in the form, so you can make changes and add it again.<br /></p>
                <p class="paragraph_style"><br /></p>
                <p class="Body"><span style="line-height: 66px; " class="style_1">4</span><br /></p>
                <p class="Body">This is just a TextView that can be cleared by clicking the 'clear' button. Firstly it serves as a feedback for the ORCA user, so he is informed whenever a command is executed from CouchDB. Secondly it is useful for debugging in the development process. Thirdly it can be used for error messages, e.g. if a user wants to add command with an already existing label.<br /></p>
                <p class="Body"><br /></p>
                <p class="Body"><br /></p>
                <p class="paragraph_style_1">Future Features<br /></p>
                <p class="Body">The tabbed section lists “commands”, “scripts”, and “Parameters”. These sections are still under development.<br /></p>
                <p class="paragraph_style_1"><br /></p>
                <p class="Body"><span class="style_2">Scripts</span><br /></p>
                <p class="Body">This section is not implemented yet. It will provide a client with the ability to run a set of scripts, that can be modified in CouchDB. This is much less restrictive than the commands section and should be used carefully.<br /></p>
                <p class="Body"><br /></p>
                <p class="Body"><span class="style_2">Parameters</span><br /></p>
                <p class="Body">Also not implemented. This will contain a set of parameters for indirectly controlling processes in ORCA.<br /></p>
                <p class="Body"><br /></p>
                <p class="paragraph_style_1">Some notes on the CouchDB interface<br /></p>
                <p class="paragraph_style_1"><br /></p>
                <p class="Body">When you start a session, the table will be converted to a CouchDB document and uploaded. The document is named 'Commands' and contains a field 'keys' where all commands are listed. To execute a command, a client has to enter the label of the command into the field 'execute'. If the command includes a '$1' sign, he can also enter an argument into the field 'Value (optional)'. After the new 'Commands' document has been uploaded, the CouchDBListener is notified and queries the changed document from CouchDB. The content is checked and if 'execute' contains a valid command it is executed. After that a success message is uploaded back on CouchDB into the &quot;Messages&quot; document and the &quot;Commands&quot; document is reset to its initial state. <br /></p>
                <p class="Body">The &quot;Messages&quot; document contains a history of messages from the Listener. The fields are named after the date and time of the message (as obtained by [NSDate date]) and contain the messages as values. <br /></p>
              </div>
            </div>
          </div>
          


          <div id="id3" style="height: 67px; left: 571px; position: absolute; top: 137px; width: 37px; z-index: 1; " class="style_SkipStroke_4 shape-with-text">
            <div class="text-content graphic_textbox_layout_style_default_External_37_67" style="padding: 0px; ">
              <div class="graphic_textbox_layout_style_default">
                <p style="padding-bottom: 0pt; padding-top: 0pt; " class="paragraph_style_2">1</p>
              </div>
            </div>
          </div>
          


          <div style="height: 24px; width: 89px;  height: 22px; left: 480px; position: absolute; top: 227px; width: 88px; z-index: 1; " class="tinyText">
            <div style="position: relative; width: 88px; ">
              <img src="CouchDB_Listener_files/shapeimage_4.png" alt="" style="height: 24px; left: 0px; margin-top: -1px; position: absolute; top: 0px; width: 89px; " />
            </div>
          </div>
          


          <div id="id4" style="height: 67px; left: 571px; position: absolute; top: 226px; width: 37px; z-index: 1; " class="style_SkipStroke_4 shape-with-text">
            <div class="text-content graphic_textbox_layout_style_default_External_37_67" style="padding: 0px; ">
              <div class="graphic_textbox_layout_style_default">
                <p style="padding-bottom: 0pt; padding-top: 0pt; " class="paragraph_style_2">2</p>
              </div>
            </div>
          </div>
          


          <div style="height: 246px; width: 443px;  height: 245px; left: 50px; position: absolute; top: 267px; width: 442px; z-index: 1; " class="tinyText">
            <div style="position: relative; width: 442px; ">
              <img src="CouchDB_Listener_files/shapeimage_5.png" alt="" style="height: 246px; left: 0px; position: absolute; top: 0px; width: 443px; " />
            </div>
          </div>
          


          <div style="height: 27px; width: 73px;  height: 25px; left: 491px; position: absolute; top: 291px; width: 73px; z-index: 1; " class="tinyText">
            <div style="position: relative; width: 73px; ">
              <img src="CouchDB_Listener_files/shapeimage_6.png" alt="" style="height: 27px; left: 0px; margin-top: -1px; position: absolute; top: 0px; width: 73px; " />
            </div>
          </div>
          


          <div id="id5" style="height: 67px; left: 571px; position: absolute; top: 290px; width: 37px; z-index: 1; " class="style_SkipStroke_4 shape-with-text">
            <div class="text-content graphic_textbox_layout_style_default_External_37_67" style="padding: 0px; ">
              <div class="graphic_textbox_layout_style_default">
                <p style="padding-bottom: 0pt; padding-top: 0pt; " class="paragraph_style_2">3</p>
              </div>
            </div>
          </div>
          


          <div style="height: 27px; width: 73px;  height: 25px; left: 466px; position: absolute; top: 577px; width: 73px; z-index: 1; " class="tinyText">
            <div style="position: relative; width: 73px; ">
              <img src="CouchDB_Listener_files/shapeimage_7.png" alt="" style="height: 27px; left: 0px; margin-top: -1px; position: absolute; top: 0px; width: 73px; " />
            </div>
          </div>
          


          <div id="id6" style="height: 67px; left: 546px; position: absolute; top: 576px; width: 37px; z-index: 1; " class="style_SkipStroke_4 shape-with-text">
            <div class="text-content graphic_textbox_layout_style_default_External_37_67" style="padding: 0px; ">
              <div class="graphic_textbox_layout_style_default">
                <p style="padding-bottom: 0pt; padding-top: 0pt; " class="paragraph_style_2">4</p>
              </div>
            </div>
          </div>
          <div style="height: 2475px; line-height: 2475px; " class="spacer"> </div>
        </div>
        <div style="height: 150px; margin-left: 0px; position: relative; width: 700px; z-index: 15; " id="footer_layer">
          <div style="height: 0px; line-height: 0px; " class="bumper"> </div>
        </div>
      </div>
    </div>
  </body>
</html>


